@page "/"
@attribute [Authorize]
@using Microsoft.AspNetCore.Components.Authorization

<PageTitle>ARO Admin - Home</PageTitle>

<AuthorizeView>
    <Authorized>
        <div class="home-main-content">
            <!-- Search Icon - Top Right Corner with Circle Background -->
            <div class="top-right-search" @onclick="HandleSearch">
                <img src="icons/searchicon.png" alt="Search" />
            </div>

            <!-- Content Card - White Box with Shadow (Figma Rectangle 1904) -->
            <div class="content-card">
                <div class="content-row">
                    <!-- Greeting Section - Left Side -->
                    <div class="greeting-section">
                        <h1>Hi @GetFirstName(context.User.Identity?.Name)!</h1>
                        <p>You don't have any groups added yet.</p>
                    </div>

                    <!-- Button Section - Right Side -->
                    <div class="button-section">
                        <button class="aro-button-primary" @onclick="HandleAddGroup">
                            Add Group +
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </Authorized>
    <NotAuthorized>
        <RedirectToLogin />
    </NotAuthorized>
</AuthorizeView>

@code {
    [Inject] private NavigationManager? NavigationManager { get; set; }

    private string GetFirstName(string? fullName)
    {
        if (string.IsNullOrWhiteSpace(fullName))
            return "Alex";

        // Try to extract first name from email or full name
        if (fullName.Contains("@"))
        {
            var emailPart = fullName.Split('@')[0];
            var nameParts = emailPart.Split('.');
            return char.ToUpper(nameParts[0][0]) + nameParts[0].Substring(1);
        }

        var parts = fullName.Split(' ');
        return parts[0];
    }

    private void HandleAddGroup()
    {
        // Navigate to add group page or show dialog
        NavigationManager?.NavigateTo("/groups/add");
    }

    private void HandleSearch()
    {
        // Implement search functionality
        // NavigationManager?.NavigateTo("/search");
    }
}

