@page "/"
@attribute [Authorize]
@inject IAuthenticationService AuthService
@inject ApiAuthenticationStateProvider AuthStateProvider
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar

<PageTitle>ARO Admin - Home</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-8">
    <AuthorizeView>
        <Authorized>
            <MudPaper Elevation="2" Class="pa-4">
                <MudText Typo="Typo.h4" GutterBottom="true">
                    Welcome to ARO Admin Portal
                </MudText>

                <MudDivider Class="my-4" />

                <MudGrid>
                    <MudItem xs="12" sm="6" md="4">
                        <MudPaper Elevation="1" Class="pa-4">
                            <MudText Typo="Typo.h6">User Information</MudText>
                            <MudText Typo="Typo.body2" Class="mt-2">
                                <strong>Name:</strong> @context.User.Identity?.Name
                            </MudText>
                            <MudText Typo="Typo.body2">
                                <strong>Email:</strong> @context.User.FindFirst("email")?.Value
                            </MudText>
                            <MudText Typo="Typo.body2">
                                <strong>Roles:</strong>
                                @string.Join(", ", context.User.Claims
                                    .Where(c => c.Type == System.Security.Claims.ClaimTypes.Role)
                                    .Select(c => c.Value))
                            </MudText>
                        </MudPaper>
                    </MudItem>

                    <MudItem xs="12" sm="6" md="4">
                        <MudPaper Elevation="1" Class="pa-4">
                            <MudText Typo="Typo.h6">Quick Actions</MudText>
                            <div class="mt-2">
                                <MudButton Variant="Variant.Filled"
                                          Color="Color.Primary"
                                          Class="mt-2"
                                          FullWidth="true"
                                          Href="/users">
                                    Manage Users
                                </MudButton>
                                <MudButton Variant="Variant.Filled"
                                          Color="Color.Secondary"
                                          Class="mt-2"
                                          FullWidth="true"
                                          Href="/roles">
                                    Manage Roles
                                </MudButton>
                            </div>
                        </MudPaper>
                    </MudItem>

                    <MudItem xs="12" sm="6" md="4">
                        <MudPaper Elevation="1" Class="pa-4">
                            <MudText Typo="Typo.h6">Account</MudText>
                            <div class="mt-2">
                                <MudButton Variant="Variant.Outlined"
                                          Color="Color.Error"
                                          Class="mt-2"
                                          FullWidth="true"
                                          OnClick="HandleLogout">
                                    Logout
                                </MudButton>
                            </div>
                        </MudPaper>
                    </MudItem>
                </MudGrid>
            </MudPaper>
        </Authorized>
        <NotAuthorized>
            <MudText Typo="Typo.h5">Please log in to access the admin portal.</MudText>
        </NotAuthorized>
    </AuthorizeView>
</MudContainer>

@code {
    private async Task HandleLogout()
    {
        try
        {
            await AuthService.LogoutAsync();
            AuthStateProvider.MarkUserAsLoggedOut();

            Snackbar.Add("You have been logged out successfully.", Severity.Info);

            NavigationManager.NavigateTo("/login");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Logout error: {ex.Message}");
            Snackbar.Add("An error occurred during logout.", Severity.Error);
        }
    }
}

