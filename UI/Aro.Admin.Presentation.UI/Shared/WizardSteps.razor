<div class="vstack gap-0 p-4">
    @for (int i = 0; i < StepTitles.Count; i++)
    {
        var stepIndex = i;
        var isActive = i == ActiveStepIndex;
        var isComplete = AllStepsCompleted ? true : i < ActiveStepIndex;
        var isClickable = IsEditMode && !isActive;

        <div class="hstack gap-3 align-items-center step-row @(isClickable ? "clickable" : "")"
             @onclick="@(() => HandleStepClick(stepIndex))"
             @onclick:stopPropagation="true">


            <div class="progress-circle @(isComplete ? "complete" : isActive ? "active": "")">
                @if (isComplete)
                {
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                         fill="currentColor" class="bi bi-check2" viewBox="0 0 16 16">
                        <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0" />
                    </svg>
                }
                else
                {
                    <span>@(i + 1)</span>
                }
            </div>

            <span class="d-sm-none d-md-block @(isComplete || isActive ? "fw-bold" : "")">
                @StepTitles[i]
            </span>
        </div>

        @if (i < StepTitles.Count - 1)
        {
            <div class="progress-line-vertical @(isComplete || isActive ? "full" : "")"></div>

            <div class="progress-line-vertical @(isComplete ? "full" : "")"></div>

        }
    }
</div>

@code {
    [Parameter] public required List<string> StepTitles { get; set; }
    [Parameter] public int ActiveStepIndex { get; set; }
    [Parameter] public bool AllStepsCompleted { get; set; }
    [Parameter] public bool IsEditMode { get; set; } = false;
    [Parameter] public EventCallback<int> OnStepClick { get; set; }

    private async Task HandleStepClick(int stepIndex)
    {
        // Only allow clicks in edit mode and not on the current step
        if (IsEditMode && stepIndex != ActiveStepIndex)
        {
            await OnStepClick.InvokeAsync(stepIndex);
        }
    }
}

<style>
    .progress-circle {
        width: 50px;
        height: 50px;
        flex: 0 0 auto;
        background: #D9D9D9;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: Inter, sans-serif;
        font-size: 16px;
        font-weight: 400;
        color: black;
    }

        .progress-circle.active {
            background-color: white;
            border: 2px solid #FF931E;
        }

        .progress-circle.complete {
            background: #FF931E;
        }

    .progress-line-vertical {
        width: 26px;
        height: 25px;
        border-right: 1px solid #D9D9D9;
    }

        .progress-line-vertical.full {
            border-right: 2px solid black;
        }

    .step-row.clickable {
        cursor: pointer;
        transition: opacity 0.2s ease;
    }

    .step-row.clickable:hover {
        opacity: 0.7;
    }

    .step-row.clickable:hover .progress-circle {
        box-shadow: 0 0 0 3px rgba(255, 147, 30, 0.3);
    }
</style>
