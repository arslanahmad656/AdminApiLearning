@page "/property/address-contact"
@using System.ComponentModel.DataAnnotations
@using Microsoft.AspNetCore.Components
@layout WizardLayout
@inject NavigationManager NavigationManager

<div class="property-wizard-container">
    <!-- Header Bar -->
    <div class="wizard-header">
        <h1 class="header-title">Create New Property</h1>
        <div class="close-icon" @onclick="HandleClose">
            <svg width="17" height="17" viewBox="0 0 17 17" fill="none">
                <line x1="1" y1="1" x2="16" y2="16" stroke="white" stroke-width="2"/>
                <line x1="16" y1="1" x2="1" y2="16" stroke="white" stroke-width="2"/>
            </svg>
        </div>
    </div>

    <div class="wizard-body">
        <!-- Left Sidebar with Steps -->
        <div class="wizard-sidebar">
            <div class="wizard-steps">
                <div class="wizard-step completed">
                    <div class="step-indicator">
                        <div class="step-number completed-check">
                            <svg width="16" height="12" viewBox="0 0 16 12" fill="none">
                                <path d="M1 5L6 10L15 1" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="step-line completed"></div>
                    </div>
                    <div class="step-title">Property Information</div>
                </div>
                <div class="wizard-step active">
                    <div class="step-indicator">
                        <div class="step-number">2</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-title">Address & Primary Contact</div>
                </div>
                <div class="wizard-step">
                    <div class="step-indicator">
                        <div class="step-number">3</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-title">Key Selling Points</div>
                </div>
                <div class="wizard-step">
                    <div class="step-indicator">
                        <div class="step-number">4</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-title">Media Files</div>
                </div>
                <div class="wizard-step">
                    <div class="step-indicator">
                        <div class="step-number">5</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-title">Marketing & SEO</div>
                </div>
                <div class="wizard-step">
                    <div class="step-indicator">
                        <div class="step-number">6</div>
                    </div>
                    <div class="step-title">Review & Save</div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="wizard-content">
            <div class="content-header">
                <p class="step-label">Step 2</p>
                <h2 class="content-title">Address & Primary Contact</h2>
            </div>

            <MudForm @ref="form" Class="address-form">
                <!-- Set the same as Primary Checkbox - Simple inline -->
                <div class="checkbox-simple">
                    <input type="checkbox" id="sameAsPrimary" @bind="model.SameAsPrimary" @bind:after="OnSameAsPrimaryChanged" />
                    <label for="sameAsPrimary" class="checkbox-label-simple">Set the same as the group address</label>
                </div>

                <!-- Primary Address and Secondary Address Row -->
                <div class="address-row-container">
                    <div class="address-column-left">
                        <div class="label-group">
                            <label class="form-label">Primary Address *</label>
                            <p class="helper-text">This address is displayed in the BE footer</p>
                        </div>
                        <MudTextField @bind-Value="model.AddressLine1"
                                      Variant="Variant.Text"
                                      Class="form-input"
                                      Placeholder="Vester Voldgade 89, 1552 Copenhagen"
                                      Required="true"
                                      HelperText=""
                                      HelperTextOnFocus="false"
                                      DisableUnderLine="true" />
                    </div>
                    <div class="address-column-right">
                        <div class="label-group-right">
                            <label class="form-label">Secondary Address (Optional)</label>
                        </div>
                        <MudTextField @bind-Value="model.AddressLine2"
                                      Variant="Variant.Text"
                                      Class="form-input secondary-input"
                                      Placeholder="Vester Voldgade 89, 1552 Copenhagen"
                                      HelperText=""
                                      HelperTextOnFocus="false"
                                      DisableUnderLine="true" />
                    </div>
                </div>

                <!-- City, Country, Postal Code Row -->
                <div class="form-row-three-col">
                    <div class="form-group">
                        <label class="form-label">City *</label>
                        <MudTextField @bind-Value="model.City"
                                      Variant="Variant.Text"
                                      Class="form-input"
                                      Placeholder="Copenhagen"
                                      Required="true"
                                      HelperText=""
                                      HelperTextOnFocus="false"
                                      DisableUnderLine="true" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Country *</label>
                        <div class="country-select-wrapper">
                            <div class="country-flag">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='20' viewBox='0 0 30 20'%3E%3Crect width='30' height='20' fill='%23C8102E'/%3E%3Crect x='0' y='8' width='30' height='4' fill='white'/%3E%3Crect x='8' y='0' width='4' height='20' fill='white'/%3E%3C/svg%3E"
                                     alt="Denmark Flag" class="flag-icon" />
                            </div>
                            <select class="form-select-country" @bind="model.Country" required>
                                <option value="">Select country</option>
                                <option value="Denmark">Denmark</option>
                                <option value="Sweden">Sweden</option>
                                <option value="Norway">Norway</option>
                                <option value="Finland">Finland</option>
                                <option value="Germany">Germany</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="France">France</option>
                                <option value="Spain">Spain</option>
                                <option value="Italy">Italy</option>
                                <option value="Netherlands">Netherlands</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Postal Code *</label>
                        <MudTextField @bind-Value="model.PostalCode"
                                      Variant="Variant.Text"
                                      Class="form-input"
                                      Placeholder="7000"
                                      Required="true"
                                      HelperText=""
                                      HelperTextOnFocus="false"
                                      DisableUnderLine="true" />
                    </div>
                </div>

                <!-- Phone Number and Website URL Row -->
                <div class="form-row-two-col-custom">
                    <div class="form-group">
                        <label class="form-label">Phone Number *</label>
                        <div class="phone-input-wrapper">
                            <div class="phone-country-flag">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='20' viewBox='0 0 30 20'%3E%3Crect width='30' height='20' fill='%23C8102E'/%3E%3Crect x='0' y='8' width='30' height='4' fill='white'/%3E%3Crect x='8' y='0' width='4' height='20' fill='white'/%3E%3C/svg%3E"
                                     alt="Denmark Flag" class="flag-icon-small" />
                            </div>
                            <div class="phone-divider"></div>
                            <input type="tel"
                                   class="phone-number-input"
                                   @bind="model.PhoneNumber"
                                   placeholder="+45 3311 4806"
                                   required />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Website URL *</label>
                        <MudTextField @bind-Value="model.WebsiteUrl"
                                      Variant="Variant.Text"
                                      Class="form-input"
                                      Placeholder="www.brochner-hotels.com/our-locations/hotel-danmark"
                                      Required="true"
                                      HelperText=""
                                      HelperTextOnFocus="false"
                                      DisableUnderLine="true" />
                    </div>
                </div>

                <!-- Primary Contact Section -->
                <div class="section-divider"></div>

                <h2 class="section-title">Primary contact</h2>

                <!-- Set the same as client primary contact Checkbox - Simple inline -->
                <div class="checkbox-simple">
                    <input type="checkbox" id="sameAsClient" @bind="model.SameAsClientContact" @bind:after="OnSameAsClientChanged" />
                    <label for="sameAsClient" class="checkbox-label-simple">Set the same as client primary contact</label>
                </div>

                <!-- Primary Contact Name, Email, Role Row -->
                <div class="form-row-three-col">
                    <div class="form-group">
                        <label class="form-label">Primary contact name *</label>
                        <MudTextField @bind-Value="model.ContactName"
                                      Variant="Variant.Text"
                                      Class="form-input"
                                      Placeholder="John Wavy"
                                      Required="true"
                                      HelperText=""
                                      HelperTextOnFocus="false"
                                      DisableUnderLine="true" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Primary contact email *</label>
                        <MudTextField @bind-Value="model.ContactEmail"
                                      Variant="Variant.Text"
                                      Class="form-input"
                                      Placeholder="JohnWavy@hoteldanmark.dk"
                                      Required="true"
                                      HelperText=""
                                      HelperTextOnFocus="false"
                                      DisableUnderLine="true" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Role</label>
                        <div class="role-display-wrapper">
                            <div class="role-display">
                                <span class="role-text">Property Manager</span>
                                <svg width="12" height="8" viewBox="0 0 12 8" class="role-icon">
                                    <path d="M1 1L6 6L11 1" stroke="#707070" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <p class="role-helper-text">Allocated by default, can't be changed.</p>
                        </div>
                    </div>
                </div>
            </MudForm>
            <!-- Footer with Buttons -->
            <WizardFooter OnBack="HandleBack"
                          OnNext="HandleNext"
                          BackDisabled="false"
                          NextDisabled="@(!IsFormValid())" />
        </div>
    </div>
</div>

@code {
    private MudForm? form;
    private AddressContactModel model = new()
    {
        AddressLine1 = "Vester Voldgade 89, 1552 Copenhagen",
        AddressLine2 = "Vester Voldgade 89, 1552 Copenhagen",
        City = "Copenhagen",
        Country = "Denmark",
        PostalCode = "7000",
        PhoneNumber = "+45 3311 4806",
        WebsiteUrl = "www.brochner-hotels.com/our-locations/hotel-danmark",
        ContactName = "John Wavy",
        ContactEmail = "JohnWavy@hoteldanmark.dk"
    };

    private bool IsFormValid()
    {
        return !string.IsNullOrWhiteSpace(model.AddressLine1) &&
               !string.IsNullOrWhiteSpace(model.City) &&
               !string.IsNullOrWhiteSpace(model.Country) &&
               !string.IsNullOrWhiteSpace(model.PostalCode) &&
               !string.IsNullOrWhiteSpace(model.PhoneNumber) &&
               !string.IsNullOrWhiteSpace(model.WebsiteUrl) &&
               !string.IsNullOrWhiteSpace(model.ContactName) &&
               !string.IsNullOrWhiteSpace(model.ContactEmail);
    }

    private void OnSameAsPrimaryChanged()
    {
        if (model.SameAsPrimary)
        {
            // TODO: Load from Group Address
            // For now, using placeholder data
        }
    }

    private void OnSameAsClientChanged()
    {
        if (model.SameAsClientContact)
        {
            // TODO: Load from Group Primary Contact
            // For now, using placeholder data
        }
    }

    private void HandleClose()
    {
        // Navigate back or show confirmation dialog
    }

    private void HandleBack()
    {
        // Navigate back to Property Information page
        NavigationManager.NavigateTo("/property/information");
    }

    private async Task HandleNext()
    {
        await form!.Validate();

        if (!form.IsValid)
        {
            return;
        }

        // Save data and navigate to next step (Facilities & Services)
        // TODO: Implement save logic (API call to save address and contact)

        // Navigate to Facilities & Services page
        NavigationManager.NavigateTo("/property/key-selling-points");
    }

    public class AddressContactModel
    {
        public bool SameAsPrimary { get; set; }

        [Required(ErrorMessage = "Address line 1 is required")]
        public string AddressLine1 { get; set; } = string.Empty;

        public string AddressLine2 { get; set; } = string.Empty;

        [Required(ErrorMessage = "City is required")]
        public string City { get; set; } = string.Empty;

        [Required(ErrorMessage = "Country is required")]
        public string Country { get; set; } = string.Empty;

        [Required(ErrorMessage = "Postal code is required")]
        public string PostalCode { get; set; } = string.Empty;

        [Required(ErrorMessage = "Phone number is required")]
        public string PhoneNumber { get; set; } = string.Empty;

        [Required(ErrorMessage = "Website URL is required")]
        public string WebsiteUrl { get; set; } = string.Empty;

        public bool SameAsClientContact { get; set; }

        [Required(ErrorMessage = "Contact name is required")]
        public string ContactName { get; set; } = string.Empty;

        [Required(ErrorMessage = "Contact email is required")]
        [EmailAddress(ErrorMessage = "Invalid email address")]
        public string ContactEmail { get; set; } = string.Empty;

        public string Role { get; set; } = "Property Manager";
    }
}

<style>
    /* Main Container */
    .property-wizard-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        background: #FFFFFF;
    }

    /* Header Bar - Dark Gray */
    .wizard-header {
        background: #434343;
        height: 72px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 24px;
    }

    .header-title {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 24px;
        line-height: 29px;
        color: #FFFFFF;
        margin: 0;
    }

    .close-icon {
        cursor: pointer;
        padding: 8px;
    }

    /* Body Container */
    .wizard-body {
        display: flex;
        flex: 1;
        overflow: hidden;
    }

    /* Left Sidebar - Light Gray */
    .wizard-sidebar {
        width: 246px;
        background: #FFFF;
        padding: 40px 20px;
        border-right: 1px solid #B3B3B3;
    }
    .wizard-steps {
        display: flex;
        flex-direction: column;
    }

    .wizard-step {
        display: flex;
        align-items: flex-start;
        margin-bottom: 32px;
        position: relative;
    }

    .wizard-step:last-child {
        margin-bottom: 0;
    }

    .step-indicator {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-right: 16px;
        position: relative;
    }

    .step-number {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: #D9D9D9;
        border: 1px solid rgba(0, 0, 0, 0.47);
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 16px;
        color: #000000;
        z-index: 2;
    }

    .wizard-step.completed .step-number {
        background: #FF931E;
        border: none;
    }

    .step-number.completed-check {
        background: #FF931E;
        border: none;
    }

    .wizard-step.active .step-number {
        border: 1px solid #FF931E;
    }


    .step-line {
        width: 2px;
        height: 60px;
        background: #D9D9D9;
        position: absolute;
        top: 50px;
        left: 24px;
        z-index: 1;
    }

    .step-line.completed {
        background: #737373;
        border: 1px solid #737373;
    }

    .wizard-step.active .step-line {
        background: #D9D9D9;
    }

    .wizard-step:last-child .step-line {
        display: none;
    }

    .step-title {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 16px;
        line-height: 26px;
        color: #000000;
        padding-top: 12px;
    }

    .wizard-step.active .step-title {
        font-weight: 600;
    }

    /* Main Content Area */
    .wizard-content {
        flex: 1;
        background: #EDEDED;
        padding: 60px 80px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }

    .content-header {
        margin-bottom: 40px;
    }

    .step-label {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 16px;
        line-height: 19px;
        color: #000000;
        margin: 0 0 8px 0;
    }

    .content-title {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 24px;
        line-height: 29px;
        color: #000000;
        margin: 0;
    }

    /* Form Styling */
    .address-form {
        max-width: 1000px;
    }

    /* Simple Checkbox - No border, just checkbox + text */
    .checkbox-simple {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 24px;
    }

    .checkbox-simple input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
        accent-color: #1C1B1F;
        margin: 0;
        border: 1px solid #C3C3C3;
    }

    .checkbox-label-simple {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-size: 16px;
        font-weight: 400;
        line-height: 19px;
        color: #000000;
        cursor: pointer;
        margin: 0;
    }

    .form-label {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-style: normal;
        font-weight: 400;
        font-size: 16px;
        line-height: 19px;
        color: #000000;
        display: block;
        margin-bottom: 8px;
    }

    .helper-text {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-size: 16px;
        font-weight: 400;
        line-height: 19px;
        color: #737373;
        margin: 0;
    }

    /* Address Row Container - Primary and Secondary side by side */
    .address-row-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 32px;
        margin-bottom: 32px;
    }

    .address-column-left {
        display: flex;
        flex-direction: column;
    }

    .address-column-right {
        display: flex;
        flex-direction: column;
    }

    /* Label groups to align properly */
    .label-group {
        margin-bottom: 8px;
    }

    .label-group-right {
        height: 46px; /* Match the height of label + helper text on left: 19px (label) + 8px (margin) + 19px (helper) */
        display: flex;
        align-items: flex-end;
        margin-bottom: 8px;
    }

    .label-group-right .form-label {
        margin-bottom: 0;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    /* Override MudBlazor TextField to match Figma */
    .address-form .form-input input.mud-input-slot,
    .address-form .form-input textarea.mud-input-slot {
        background: #F5F5F5 !important;
        border: 1px solid #C3C3C3 !important;
        border-radius: 0px !important;
        height: 50px !important;
        box-shadow: none !important;
        padding: 0 18px !important;
        margin: 0 !important;
        width: 100% !important;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
        font-weight: 400 !important;
        font-size: 16px !important;
        line-height: 19px !important;
        color: #000000 !important;
    }

    .address-form .form-input.secondary-input input.mud-input-slot {
        color: #737373 !important;
    }

    .address-form .form-input input.mud-input-slot::placeholder,
    .address-form .form-input textarea.mud-input-slot::placeholder {
        color: #000000 !important;
        opacity: 1 !important;
    }

    /* Remove MudBlazor underline */
    .address-form .form-input .mud-input-underline::before,
    .address-form .form-input .mud-input-underline::after {
        display: none !important;
    }

    .address-form .form-input .mud-input-line {
        display: none !important;
    }

    /* Three Column Row */
    .form-row-three-col {
        display: grid;
        grid-template-columns: 260px 340px 260px;
        gap: 32px;
        margin-bottom: 32px;
    }

    /* Country Select with Flag */
    .country-select-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        background: #F5F5F5;
        border: 1px solid #C3C3C3;
        height: 50px;
    }

    .country-flag {
        padding: 0 12px;
        display: flex;
        align-items: center;
        border-right: 1px solid #C3C3C3;
        height: 100%;
    }

    .flag-icon {
        width: 30px;
        height: 20px;
        object-fit: contain;
    }

    .form-select-country {
        flex: 1;
        height: 100%;
        background: transparent;
        border: none;
        padding: 0 40px 0 18px;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-size: 16px;
        font-weight: 400;
        color: #000000;
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%23000000' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' fill='none'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
    }

    .form-select-country:focus {
        outline: none;
    }

    /* Custom Two Column Row for Phone and Website */
    .form-row-two-col-custom {
        display: grid;
        grid-template-columns: 310px 1fr;
        gap: 32px;
        margin-bottom: 40px;
    }

    /* Phone Input with Flag */
    .phone-input-wrapper {
        display: flex;
        align-items: center;
        background: #F5F5F5;
        border: 1px solid #C3C3C3;
        height: 50px;
    }

    .phone-country-flag {
        padding: 0 12px;
        display: flex;
        align-items: center;
    }

    .flag-icon-small {
        width: 30px;
        height: 20px;
        object-fit: contain;
    }

    .phone-divider {
        width: 1px;
        height: 48px;
        background: #C3C3C3;
    }

    .phone-number-input {
        flex: 1;
        height: 100%;
        border: none;
        background: transparent;
        padding: 0 18px;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-size: 16px;
        font-weight: 400;
        color: #000000;
    }

    .phone-number-input:focus {
        outline: none;
    }

    .phone-number-input::placeholder {
        color: #000000;
        opacity: 1;
    }

    /* Section Divider */
    .section-divider {
        height: 60px;
    }

    .section-title {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-weight: 400;
        font-size: 24px;
        line-height: 29px;
        color: #000000;
        margin: 0 0 32px 0;
    }

    /* Role Display Field */
    .role-display-wrapper {
        display: flex;
        flex-direction: column;
    }

    .role-display {
        background: #F5F5F5;
        border: 1px solid #C3C3C3;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 18px;
    }

    .role-text {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-size: 16px;
        font-weight: 400;
        color: #707070;
    }

    .role-icon {
        opacity: 0.8;
    }

    .role-helper-text {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-size: 14px;
        font-weight: 400;
        line-height: 17px;
        color: #707070;
        margin: 8px 0 0 0;
    }

</style>
